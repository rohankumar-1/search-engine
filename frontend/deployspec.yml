version: 0.2
# This file serves as an entry point for CodeBuild when it's looking for deployspec.yml
# It ensures the correct paths are set up for the actual build process

phases:
  install:
    runtime-versions:
      nodejs: 16
    commands:
      - echo "Starting deployment process with deployspec.yml..."
      - echo "Current directory: $(pwd)"
      - ls -la
      - ls -la frontend || echo "Cannot find frontend directory"
      
      # CodeBuild environment setup
      - |
        if [ -d "/codebuild" ]; then
          echo "In CodeBuild environment, setting up paths..."
          CODEBUILD_SRC_DIR_PATH=$(echo $CODEBUILD_SRC_DIR)
          echo "CodeBuild source directory: $CODEBUILD_SRC_DIR_PATH"
          
          # If a buildspec.yml exists, tell CodeBuild to use it for the next phase
          if [ -f "frontend/buildspec.yml" ]; then
            echo "Found buildspec.yml, using it for the build process..."
            cp frontend/buildspec.yml $CODEBUILD_SRC_DIR_PATH/buildspec.yml
          fi
        fi

  pre_build:
    commands:
      - echo "Pre-build phase in deployspec.yml"
      - echo "Environment variables: ENVIRONMENT=$ENVIRONMENT, AWS_REGION=$AWS_REGION, FRONTEND_STACK_NAME=$FRONTEND_STACK_NAME"

  build:
    commands:
      - echo "Build phase in deployspec.yml"
      # Add any deployment-specific build steps here

  post_build:
    commands:
      - echo "Post-build phase in deployspec.yml"
      # Add any deployment-specific post-build steps here

artifacts:
  files:
    - '**/*'
  discard-paths: no

cache:
  paths:
    - 'frontend/node_modules/**/*' 